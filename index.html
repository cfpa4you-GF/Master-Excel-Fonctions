<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Excel Pro - ØªØ¹Ù„Ù… Ø¨Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#107c41">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { excelGreen: '#107c41', excelDark: '#0d6334' },
                    borderRadius: { '3xl': '1.5rem', '4xl': '2rem' }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom); }
        body { 
            font-family: 'Tajawal', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #f8fafc;
            padding-top: var(--safe-top);
            user-select: none;
        }
        .dark body { background-color: #0f172a; color: #f1f5f9; }
        
        /* Mobile-Optimized Grid */
        .excel-grid { border-collapse: collapse; direction: ltr; width: 100%; table-layout: fixed; }
        .excel-grid td, .excel-grid th { 
            border: 1px solid #e2e8f0; 
            padding: 8px 4px; 
            font-size: 12px; 
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .dark .excel-grid td, .dark .excel-grid th { border-color: #334155; }
        .excel-grid th { background-color: #f1f5f9; color: #64748b; font-weight: 800; width: 30px; }
        .dark .excel-grid th { background-color: #1e293b; color: #94a3b8; }

        /* Floating Nav Animation */
        #navBar { transition: transform 0.3s ease-in-out; }
        .nav-hidden { transform: translateY(100%); }

        /* Smooth Transitions */
        .page-transition { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar for Mobile */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Touch targets */
        button, a, input { min-height: 44px; }
        
        .insta-gradient { background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); }
    </style>
</head>
<body class="pb-32">

    <!-- Top Notification Bar -->
    <div class="excelGreen text-white text-[10px] py-1 px-4 text-center font-medium sticky top-0 z-[60] shadow-sm">
        ÙŠØ³Ø¹Ø¯Ù†ÙŠ ØªÙˆØ§ØµÙ„ÙƒÙ… Ù„Ø·Ù„Ø¨ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ø®ØµØµØ© Ø£Ùˆ Ø¯Ø±ÙˆØ³ Ù…ØªÙ‚Ø¯Ù…Ø©.
    </div>

    <!-- Main Header -->
    <header class="bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800 sticky top-[20px] z-50 px-4 py-3">
        <div class="flex justify-between items-center max-w-md mx-auto">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 excelGreen rounded-lg flex items-center justify-center shadow-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 17h6l2 2 2-2h2m-2-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2h4l2 2 2-2z"></path></svg>
                </div>
                <h1 class="font-bold text-lg dark:text-white">Excel<span class="text-excelGreen">Pro</span></h1>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleDarkMode()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-gray-50 dark:bg-gray-800">ğŸŒ“</button>
                <div class="bg-emerald-50 dark:bg-emerald-900/30 px-3 py-1.5 rounded-xl border border-emerald-100 dark:border-emerald-800 flex items-center gap-2">
                    <span class="text-emerald-600 dark:text-emerald-400 font-bold text-sm" id="userPoints">0</span>
                    <span class="text-xs">ğŸ†</span>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-4 pt-6 space-y-6">
        
        <!-- Welcome Section -->
        <section id="dashboard" class="page-transition space-y-6">
            <div class="bg-gradient-to-br from-excelGreen to-excelDark p-6 rounded-3xl shadow-xl text-white relative overflow-hidden">
                <div class="relative z-10">
                    <h2 class="text-2xl font-extrabold mb-1">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ!</h2>
                    <p class="text-emerald-100 text-sm opacity-90">Ø¬Ø§Ù‡Ø² Ù„Ø§Ø­ØªØ±Ø§Ù 80 Ø¯Ø§Ù„Ø© ÙÙŠ Ø£ÙƒØ³Ù„ØŸ</p>
                </div>
                <div class="absolute -bottom-4 -left-4 w-24 h-24 bg-white/10 rounded-full blur-2xl"></div>
            </div>

            <!-- Instagram Link -->
            <a href="https://instagram.com/prof.i3lam_ali" target="_blank" class="flex items-center justify-between bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm border border-gray-50 dark:border-gray-800 group active:scale-95 transition-all">
                <div class="flex items-center gap-3">
                    <div class="insta-gradient p-2.5 rounded-xl text-white shadow-md">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                    </div>
                    <span class="font-bold text-gray-700 dark:text-gray-200 ltr">prof.i3lam_ali</span>
                </div>
                <span class="text-gray-300">â”</span>
            </a>

            <!-- Categories Grid -->
            <div class="grid grid-cols-2 gap-4" id="categoriesGrid"></div>

            <!-- Full Quiz CTA -->
            <button onclick="startFullQuiz()" class="w-full bg-blue-600 text-white p-5 rounded-3xl shadow-xl flex justify-between items-center active:scale-[0.98] transition-all">
                <div class="text-right">
                    <h4 class="font-black text-lg">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h4>
                    <p class="text-blue-100 text-[10px] opacity-80">Ø§Ø®ØªØ¨Ø± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ÙÙŠ ÙƒØ§ÙØ© Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center text-2xl">ğŸš€</div>
            </button>

            <!-- Installation Guide (Enhanced for Mobile) -->
            <div class="bg-gray-100 dark:bg-gray-800/50 p-6 rounded-3xl space-y-4">
                <h3 class="font-bold text-sm flex items-center gap-2">
                    <span class="text-xl">ğŸ“²</span> ÙƒÙŠÙ ØªØ«Ø¨Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ
                </h3>
                <div class="space-y-3">
                    <div class="bg-white dark:bg-gray-800 p-3 rounded-2xl flex items-center gap-3">
                        <span class="w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 flex items-center justify-center text-xs font-bold">iOS</span>
                        <p class="text-[11px] leading-relaxed">Ø§Ø¶ØºØ· <span class="font-bold">Ù…Ø´Ø§Ø±ÙƒØ© ğŸ“¤</span> Ø«Ù… <span class="font-bold">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></p>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-3 rounded-2xl flex items-center gap-3">
                        <span class="w-6 h-6 rounded-full bg-green-100 dark:bg-green-900 text-green-600 flex items-center justify-center text-xs font-bold">And</span>
                        <p class="text-[11px] leading-relaxed">Ø§Ø¶ØºØ· <span class="font-bold">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø«Ù„Ø§Ø« â‹®</span> Ø«Ù… <span class="font-bold">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Library Section -->
        <section id="libraryView" class="hidden page-transition">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-black">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¯ÙˆØ§Ù„</h2>
                <div class="text-[10px] bg-emerald-100 text-emerald-700 px-2 py-1 rounded-lg font-bold">80 Ø¯Ø§Ù„Ø©</div>
            </div>
            
            <div class="sticky top-20 z-40 bg-[#f8fafc] dark:bg-[#0f172a] pb-4 space-y-4">
                <div class="bg-white dark:bg-gray-800 p-2 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800">
                    <select id="libSearch" onchange="searchFunction(this.value)" class="w-full p-2 bg-transparent outline-none text-sm ltr font-bold text-gray-600 dark:text-gray-300">
                        <option value="">ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯Ø§Ù„Ø©...</option>
                    </select>
                </div>
                <div class="flex overflow-x-auto gap-3 no-scrollbar py-1" id="libraryTabs"></div>
            </div>

            <div id="libraryContent" class="space-y-4"></div>
        </section>

        <!-- Quiz Section -->
        <section id="quizView" class="hidden page-transition">
            <div class="bg-white dark:bg-gray-800 rounded-4xl p-6 shadow-2xl border border-gray-50 dark:border-gray-800 space-y-6">
                <div class="flex justify-between items-center">
                    <span id="quizCatName" class="text-xs font-bold text-emerald-600 px-3 py-1 bg-emerald-50 dark:bg-emerald-900/30 rounded-full"></span>
                    <span id="quizStepCounter" class="text-[10px] font-bold text-gray-400"></span>
                </div>
                
                <h3 id="quizQuestion" class="text-lg font-bold leading-snug"></h3>
                
                <div class="bg-slate-50 dark:bg-gray-900/50 p-3 rounded-2xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="excel-grid" id="quizTable"></table>
                    </div>
                </div>

                <div class="space-y-4">
                    <input type="text" id="quizInput" autofocus class="w-full p-5 bg-gray-50 dark:bg-gray-900 rounded-2xl font-mono text-center ltr outline-none focus:ring-4 focus:ring-emerald-500/20 transition-all border border-gray-100 dark:border-gray-800" placeholder="=NAME(cell)">
                    <div id="quizFeedback" class="hidden p-4 rounded-2xl text-xs font-bold text-center animate-bounce"></div>
                    
                    <button id="submitBtn" onclick="checkAnswer()" class="w-full py-5 bg-excelGreen text-white rounded-2xl font-bold shadow-lg shadow-emerald-500/30 active:scale-95 transition-all">ØªØ­Ù‚Ù‚</button>
                    <button id="nextBtn" onclick="nextQuestion()" class="hidden w-full py-5 bg-blue-600 text-white rounded-2xl font-bold shadow-lg shadow-blue-500/30">Ø§Ù„ØªØ§Ù„ÙŠ â”</button>
                </div>
            </div>
        </section>

        <!-- Result View -->
        <section id="resultView" class="hidden page-transition text-center py-12">
            <div class="w-32 h-32 bg-yellow-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl animate-pulse">
                <span class="text-6xl">ğŸ†</span>
            </div>
            <h2 class="text-3xl font-black mb-2">Ø£Ù†Øª Ù…Ø°Ù‡Ù„!</h2>
            <p class="text-gray-500 mb-8">Ù„Ù‚Ø¯ Ø£Ù†Ø¬Ø²Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­.</p>
            <div class="bg-white dark:bg-gray-800 p-8 rounded-4xl shadow-xl inline-block mb-10 min-w-[200px]">
                <div class="text-5xl font-black text-excelGreen mb-1" id="finalScore">0</div>
                <div class="text-xs font-bold text-gray-400 uppercase tracking-widest">Ù†Ù‚Ø·Ø©</div>
            </div>
            <br>
            <button onclick="goHome()" class="px-12 py-5 bg-gray-900 text-white rounded-2xl font-bold active:scale-95 transition-all">ØªÙ…</button>
        </section>

    </main>

    <!-- Bottom Navigation Bar (Very Mobile Specific) -->
    <nav id="navBar" class="fixed bottom-0 left-0 right-0 z-[100] bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border-t border-gray-100 dark:border-gray-800 pb-safe">
        <div class="max-w-md mx-auto flex justify-around items-center p-3">
            <button onclick="goHome()" class="flex flex-col items-center gap-1 text-excelGreen">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            <button onclick="toggleLibrary()" class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                <span class="text-[10px] font-bold">Ø§Ù„Ù…ÙƒØªØ¨Ø©</span>
            </button>
            <button onclick="startFullQuiz()" class="w-14 h-14 bg-excelGreen rounded-full -mt-10 border-4 border-[#f8fafc] dark:border-[#0f172a] shadow-xl flex items-center justify-center text-white active:scale-90 transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </button>
            <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
                <span class="text-[10px] font-bold">Ù„Ø£Ø¹Ù„Ù‰</span>
            </button>
            <button onclick="toggleDarkMode()" class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                <span class="text-[10px] font-bold">Ø§Ù„Ù…Ø¸Ù‡Ø±</span>
            </button>
        </div>
    </nav>

    <script>
        const categories = {
            math: { name: "Ø­Ø³Ø§Ø¨ÙŠØ©", icon: "ğŸ“", color: "blue", functions: [
                { name: "SOMME", desc: "Ø¬Ù…Ø¹ Ù†Ø·Ø§Ù‚ Ù…Ù† Ø§Ù„Ø®Ù„Ø§ÙŠØ§.", syntax: "=SOMME(A1:A10)", example: "=SOMME(10;20)", uiData: { h:['Val'], b:[['10'],['20']], target:'B1', result:'30' }, explain: "ØªÙ‚ÙˆÙ… Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯." },
                { name: "PRODUIT", desc: "Ø¶Ø±Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù….", syntax: "=PRODUIT(A1;B1)", example: "=PRODUIT(5;4)", uiData: { h:['A','B'], b:[['5','4']], target:'C1', result:'20' }, explain: "ØªØ¶Ø±Ø¨ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¨Ø¹Ø¶Ù‡Ø§." },
                { name: "ARRONDI", desc: "ØªÙ‚Ø±ÙŠØ¨ Ø±Ù‚Ù….", syntax: "=ARRONDI(nb; dec)", example: "=ARRONDI(15.67; 1)", uiData: { h:['Nb'], b:[['15.67']], target:'B1', result:'15.7' }, explain: "ØªÙ‚Ø±Ø¨ Ø§Ù„Ø±Ù‚Ù… Ù„Ø¹Ø¯Ø¯ Ù…Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„Ø®Ø§Ù†Ø§Øª." }
            ], quiz: { q: "Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ B Ù…Ù† Ø§Ù„Ø³Ø·Ø± 1 Ù„Ù€ 3.", table: { h:['A','B'], b:[['P1','100'],['P2','200'],['P3','300']] }, correct: ["=SOMME(B1:B3)"], points: 10 } },
            logic: { name: "Ù…Ù†Ø·Ù‚ÙŠØ©", icon: "ğŸ§ ", color: "purple", functions: [
                { name: "SI", desc: "Ø¯Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ø·.", syntax: "=SI(test; v; f)", example: "=SI(A1>10; \"OK\"; \"NO\")", uiData: { h:['Note'], b:[['12']], target:'B1', result:'OK' }, explain: "ØªÙ†ÙØ° Ø£Ù…Ø±Ø§Ù‹ Ø¥Ø°Ø§ ØªØ­Ù‚Ù‚ Ø§Ù„Ø´Ø±Ø· ÙˆØ¢Ø®Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ­Ù‚Ù‚." }
            ], quiz: { q: "Ø¥Ø°Ø§ ÙƒØ§Ù† A1 Ø£ÙƒØ¨Ø± Ù…Ù† 10 Ø§ÙƒØªØ¨ 'Pass' ÙˆØ¥Ù„Ø§ 'Fail'.", table: { h:['A'], b:[['15']] }, correct: ["=SI(A1>10;\"PASS\";\"FAIL\")"], points: 15 } },
            text: { name: "Ù†ØµÙˆØµ", icon: "ğŸ“", color: "amber", functions: [
                { name: "CONCAT", desc: "Ø¯Ù…Ø¬ Ù†ØµÙˆØµ.", syntax: "=CONCAT(A1; B1)", example: "=CONCAT(\"Hi \"; \"Ali\")", uiData: { h:['T1','T2'], b:[['Hi','Ali']], target:'C1', result:'Hi Ali' }, explain: "ØªØ±Ø¨Ø· Ø§Ù„Ù†ØµÙˆØµ Ø¨Ø¨Ø¹Ø¶Ù‡Ø§ Ø§Ù„Ø¨Ø¹Ø¶." }
            ], quiz: { q: "Ø§Ø¯Ù…Ø¬ Ø§Ù„Ø§Ø³Ù… ÙÙŠ A1 ÙˆØ§Ù„Ù„Ù‚Ø¨ ÙÙŠ B1 Ø¨Ù…Ø³Ø§ÙØ©.", table: { h:['A','B'], b:[['Ali','Ahmed']] }, correct: ["=CONCAT(A1;\" \";B1)","=A1&\" \"&B1"], points: 10 } },
            lookup: { name: "Ø¨Ø­Ø«", icon: "ğŸ”", color: "rose", functions: [
                { name: "RECHERCHEV", desc: "Ø¨Ø­Ø« Ø¹Ù…ÙˆØ¯ÙŠ.", syntax: "=RECHERCHEV(v; tab; col; 0)", example: "=RECHERCHEV(\"1\"; A1:B2; 2; 0)", uiData: { h:['ID','Nom'], b:[['1','Ali'],['2','Bob']], target:'D1', result:'Ali' }, explain: "ØªØ¨Ø­Ø« Ø¹Ù† Ù‚ÙŠÙ…Ø© ÙÙŠ Ø¹Ù…ÙˆØ¯ ÙˆØªØ¹ÙŠØ¯ Ù‚ÙŠÙ…Ø© Ù…Ù‚Ø§Ø¨Ù„Ø©." }
            ], quiz: { q: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³Ø¹Ø± 'PC' ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ A1:B3 (Ø§Ù„Ø¹Ù…ÙˆØ¯ 2).", table: { h:['Prod','Prix'], b:[['PC','500'],['TV','300']] }, correct: ["=RECHERCHEV(\"PC\";A1:B3;2;0)"], points: 20 } },
            stat: { name: "Ø¥Ø­ØµØ§Ø¦ÙŠØ©", icon: "ğŸ“Š", color: "emerald", functions: [
                { name: "MOYENNE", desc: "Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ.", syntax: "=MOYENNE(p)", example: "=MOYENNE(10;20)", uiData: { h:['V'], b:[['10'],['20']], target:'B1', result:'15' }, explain: "Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø±Ù‚Ø§Ù…." }
            ], quiz: { q: "Ø£ÙˆØ¬Ø¯ Ø£ÙƒØ¨Ø± Ù‚ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ A1:A4.", table: { h:['V'], b:[['10'],['50'],['20'],['40']] }, correct: ["=MAX(A1:A4)"], points: 10 } },
            date: { name: "Ø²Ù…Ù†ÙŠØ©", icon: "ğŸ“…", color: "indigo", functions: [
                { name: "ANNEE", desc: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ù†Ø©.", syntax: "=ANNEE(d)", example: "=ANNEE(\"15/05/2023\")", uiData: { h:['D'], b:[['15/05/23']], target:'B1', result:'2023' }, explain: "ØªØ³ØªØ®Ø±Ø¬ Ø§Ù„Ø³Ù†Ø© Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®." }
            ], quiz: { q: "Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø³Ù†Ø© Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ A1.", table: { h:['A'], b:[['20/12/2025']] }, correct: ["=ANNEE(A1)"], points: 10 } }
        };

        let totalPoints = parseInt(localStorage.getItem('excelPointsMobile') || 0);
        let currentQuizQueue = [];
        let currentStep = 0;
        let sessionScore = 0;
        let activeLibraryCat = 'math';

        function init() {
            document.getElementById('userPoints').innerText = totalPoints;
            const grid = document.getElementById('categoriesGrid');
            Object.keys(categories).forEach(key => {
                const cat = categories[key];
                const div = document.createElement('div');
                div.className = `bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm border border-gray-50 dark:border-gray-800 flex flex-col items-center gap-2 cursor-pointer active:scale-95 active:bg-gray-50 transition-all`;
                div.onclick = () => startSingleQuiz(key);
                div.innerHTML = `<span class="text-3xl">${cat.icon}</span><span class="font-bold text-xs text-gray-700 dark:text-gray-300">${cat.name}</span>`;
                grid.appendChild(div);
            });
            buildLibraryTabs();
            populateSearchList();
            
            // Auto hide/show nav on scroll
            let lastScroll = 0;
            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;
                const nav = document.getElementById('navBar');
                if (currentScroll > lastScroll && currentScroll > 100) nav.classList.add('nav-hidden');
                else nav.classList.remove('nav-hidden');
                lastScroll = currentScroll;
            });
        }

        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); }

        function goHome() {
            document.querySelectorAll('main > section').forEach(d => d.classList.add('hidden'));
            document.getElementById('dashboard').classList.remove('hidden');
            updateNavIcons('home');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function updateNavIcons(active) {
            const btns = document.querySelectorAll('#navBar button');
            btns.forEach(btn => btn.classList.replace('text-excelGreen', 'text-gray-400'));
            if(active === 'home') btns[0].classList.replace('text-gray-400', 'text-excelGreen');
            if(active === 'lib') btns[1].classList.replace('text-gray-400', 'text-excelGreen');
        }

        function toggleLibrary() {
            document.querySelectorAll('main > section').forEach(d => d.classList.add('hidden'));
            document.getElementById('libraryView').classList.remove('hidden');
            updateNavIcons('lib');
            renderLibraryContent(activeLibraryCat);
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function populateSearchList() {
            const select = document.getElementById('libSearch');
            let all = [];
            Object.keys(categories).forEach(k => categories[k].functions.forEach(f => all.push({n: f.name, k})));
            all.sort((a,b) => a.n.localeCompare(b.n)).forEach(item => {
                const opt = document.createElement('option');
                opt.value = `${item.k}|${item.n}`;
                opt.innerText = item.n;
                select.appendChild(opt);
            });
        }

        function searchFunction(val) {
            if(!val) return;
            const [cat, name] = val.split('|');
            activeLibraryCat = cat; buildLibraryTabs(); renderLibraryContent(cat);
            setTimeout(() => {
                const el = document.getElementById(`func-${name}`);
                if(el) {
                    const offset = el.getBoundingClientRect().top + window.pageYOffset - 180;
                    window.scrollTo({top: offset, behavior: 'smooth'});
                }
            }, 100);
        }

        function buildLibraryTabs() {
            const container = document.getElementById('libraryTabs');
            container.innerHTML = '';
            Object.keys(categories).forEach(key => {
                const cat = categories[key];
                const btn = document.createElement('button');
                btn.className = `px-5 py-2 rounded-2xl whitespace-nowrap text-xs font-bold transition-all ${activeLibraryCat === key ? 'bg-excelGreen text-white shadow-lg' : 'bg-white dark:bg-gray-800 text-gray-400'}`;
                btn.onclick = () => { activeLibraryCat = key; buildLibraryTabs(); renderLibraryContent(key); };
                btn.innerText = `${cat.icon} ${cat.name}`;
                container.appendChild(btn);
            });
        }

        function renderLibraryContent(catKey) {
            const container = document.getElementById('libraryContent');
            container.innerHTML = '';
            categories[catKey].functions.forEach(func => {
                const card = document.createElement('div');
                card.id = `func-${func.name}`;
                card.className = "bg-white dark:bg-gray-800 p-5 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800";
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-black text-excelGreen text-lg">${func.name}</h4>
                        <span class="text-[9px] bg-gray-50 dark:bg-gray-700 px-2 py-1 rounded-lg font-black text-gray-400 uppercase">Function</span>
                    </div>
                    <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">${func.desc}</p>
                    <div class="bg-gray-50 dark:bg-gray-900/50 rounded-2xl overflow-hidden border border-gray-100 dark:border-gray-800 ltr">
                        <div class="bg-gray-100 dark:bg-gray-800 px-3 py-2 text-[10px] font-mono text-gray-400">Formula Example</div>
                        <div class="p-3">
                            <table class="excel-grid">
                                <thead><tr><th></th>${func.uiData.h.map(h => `<th>${h}</th>`).join('')}</tr></thead>
                                <tbody>${func.uiData.b.map((r, i) => `<tr><th>${i+1}</th>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('')}</tbody>
                            </table>
                            <div class="mt-3 text-[11px] font-mono text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 p-2 rounded-lg">Result: ${func.uiData.result}</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function startFullQuiz() { currentQuizQueue = Object.keys(categories); currentStep = 0; sessionScore = 0; showQuiz(); }
        function startSingleQuiz(key) { currentQuizQueue = [key]; currentStep = 0; sessionScore = 0; showQuiz(); }

        function showQuiz() {
            document.querySelectorAll('main > section').forEach(d => d.classList.add('hidden'));
            document.getElementById('quizView').classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            const catKey = currentQuizQueue[currentStep];
            const data = categories[catKey];
            document.getElementById('quizCatName').innerText = data.name;
            document.getElementById('quizStepCounter').innerText = `${currentStep+1} / ${currentQuizQueue.length}`;
            document.getElementById('quizQuestion').innerText = data.quiz.q;
            document.getElementById('quizInput').value = "";
            document.getElementById('quizFeedback').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('submitBtn').classList.remove('hidden');
            const table = document.getElementById('quizTable');
            table.innerHTML = `<thead><tr><th></th>${data.quiz.table.h.map(h => `<th>${h}</th>`).join('')}</tr></thead>
                               <tbody>${data.quiz.table.b.map((r, i) => `<tr><th>${i+1}</th>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('')}</tbody>`;
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function checkAnswer() {
            const input = document.getElementById('quizInput').value.trim().toUpperCase().replace(/\s/g, '');
            const quiz = categories[currentQuizQueue[currentStep]].quiz;
            const isCorrect = quiz.correct.some(a => a.toUpperCase().replace(/\s/g, '') === input);
            const feedback = document.getElementById('quizFeedback');
            feedback.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
            if(isCorrect) {
                feedback.innerText = "Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ¨";
                feedback.classList.add('bg-green-100', 'text-green-700');
                sessionScore += quiz.points;
                totalPoints += quiz.points;
                localStorage.setItem('excelPointsMobile', totalPoints);
                document.getElementById('userPoints').innerText = totalPoints;
                document.getElementById('submitBtn').classList.add('hidden');
                document.getElementById('nextBtn').classList.remove('hidden');
            } else {
                feedback.innerText = "Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ğŸ§";
                feedback.classList.add('bg-red-100', 'text-red-700');
            }
        }

        function nextQuestion() {
            if(currentStep < currentQuizQueue.length - 1) {
                currentStep++; loadQuestion();
            } else {
                document.getElementById('quizView').classList.add('hidden');
                document.getElementById('resultView').classList.remove('hidden');
                document.getElementById('finalScore').innerText = sessionScore;
            }
        }

        window.onload = init;
    </script>
</body>
</html>