<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ¹Ù„Ù… Ø£ÙƒØ³Ù„ Ø¨Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† - 80 Ø¯Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„Ø´Ø±Ø­</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø£ÙƒØ³Ù„ Ø¨Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†">
    <link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Microsoft_Office_Excel_%282019%E2%80%93present%29.svg/192px-Microsoft_Office_Excel_%282019%E2%80%93present%29.svg.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#107c41">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { excelGreen: '#107c41' }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s ease; }
        body { background-color: #f3f4f6; color: #1f2937; }
        .dark body { background-color: #111827; color: #f9fafb; }
        .excel-green { background-color: #107c41; }
        .excel-grid { border-collapse: collapse; direction: ltr; }
        .excel-grid td, .excel-grid th { border: 1px solid #d1d5db; padding: 4px 8px; font-size: 11px; }
        .dark .excel-grid td, .dark .excel-grid th { border-color: #4b5563; }
        .excel-grid th { background-color: #f8fafc; color: #64748b; }
        .dark .excel-grid th { background-color: #1f2937; color: #9ca3af; }
        .ltr { direction: ltr; text-align: left; }
        .category-tab.active { border-bottom: 3px solid #107c41; color: #107c41; font-weight: bold; }
        .dark .category-tab.active { color: #34d399; border-color: #34d399; }
        #floatingHome, #scrollTopBtn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); transform: scale(0); opacity: 0; pointer-events: none; }
        #floatingHome.visible, #scrollTopBtn.visible { transform: scale(1); opacity: 1; pointer-events: auto; }
        .excel-ui-box { background: #fff; border: 1px solid #c0c0c0; border-radius: 4px; overflow: hidden; }
        .dark .excel-ui-box { background: #1f2937; border-color: #4b5563; }
        .excel-formula-bar { padding: 4px 8px; font-family: monospace; font-size: 12px; border-bottom: 1px solid #eee; }
        .dark .excel-formula-bar { border-color: #4b5563; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-24">

    <!-- Floating Home -->
    <button id="floatingHome" onclick="goHome()" class="fixed bottom-6 left-6 z-[60] w-14 h-14 excel-green text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
    </button>

    <!-- Scroll Top Button -->
    <button id="scrollTopBtn" onclick="scrollToTop()" class="fixed bottom-24 left-6 z-[60] w-12 h-12 bg-white dark:bg-gray-800 text-excelGreen dark:text-emerald-400 border border-gray-200 dark:border-gray-700 rounded-full shadow-xl flex items-center justify-center hover:scale-110 active:scale-95">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
    </button>

    <!-- Header -->
    <header class="excel-green text-white p-4 shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-lg font-bold flex items-center gap-2">
                Excel Pro (80+ Fonctions)
            </h1>
            <div class="flex items-center gap-3">
                <button onclick="toggleDarkMode()" class="p-2 bg-white/10 rounded-full">ğŸŒ“</button>
                <div class="bg-white/20 px-3 py-1 rounded-full text-sm font-bold">ğŸ† <span id="userPoints">0</span></div>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4">
        <!-- Dashboard -->
        <div id="dashboard">
            <!-- Social Link Header -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm mb-4 flex items-center justify-center gap-3">
                <a href="https://instagram.com/prof.i3lam_ali" target="_blank" class="flex items-center gap-2 bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 text-white px-4 py-2 rounded-full border border-white/20 shadow-sm active:scale-95 transition-transform">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                    <span class="font-bold text-sm ltr">prof.i3lam_ali</span>
                </a>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm mb-6 flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold">ØªØ¹Ù„Ù… Ø¨Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</h2>
                    <p class="text-gray-500 text-sm">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø³Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</p>
                </div>
                <button onclick="toggleLibrary()" class="bg-amber-500 text-white px-4 py-2 rounded-xl font-bold text-sm shadow-lg">ğŸ“– Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù€ 80 Ø¯Ø§Ù„Ø©</button>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-6" id="categoriesGrid"></div>
            
            <button onclick="startFullQuiz()" class="w-full bg-blue-600 text-white p-5 rounded-2xl shadow-lg flex justify-between items-center mb-6">
                <div class="text-right">
                    <h4 class="font-bold text-lg">Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„</h4>
                    <p class="text-blue-100 text-xs">ØªÙ…Ø±ÙŠÙ† Ù…Ù† ÙƒÙ„ ÙØ¦Ø© Ø£Ø³Ø§Ø³ÙŠØ©</p>
                </div>
                <span class="text-3xl">ğŸš€</span>
            </button>

            <!-- Support & Info Section -->
            <div class="bg-emerald-50 dark:bg-emerald-950/20 rounded-3xl p-6 border border-emerald-100 dark:border-emerald-900/30">
                <h3 class="font-bold text-emerald-800 dark:text-emerald-400 mb-3 flex items-center gap-2">
                    <span>ğŸ’¡</span> Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø£Ùˆ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø£Ø®Ø±Ù‰ØŸ
                </h3>
                <p class="text-sm text-emerald-700/80 dark:text-emerald-300/80 leading-relaxed mb-4">
                    ÙŠØ³Ø¹Ø¯Ù†ÙŠ ØªÙˆØ§ØµÙ„ÙƒÙ… Ù…Ø¹ÙŠ Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø¯Ø±ÙˆØ³ Ø§Ù„Ø£ÙƒØ³Ù„ Ø£Ùˆ Ù„Ø·Ù„Ø¨ Ø¨Ø±Ù…Ø¬Ø© ØªØ·Ø¨ÙŠÙ‚Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø®ØµØµØ©. 
                    Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø´Ø§Ø´ØªÙƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.
                </p>
                
                <div class="space-y-3">
                    <div class="bg-white/50 dark:bg-black/20 p-3 rounded-xl">
                        <p class="text-xs font-bold text-emerald-900 dark:text-emerald-200 mb-1">ğŸ“² Ø·Ø±ÙŠÙ‚Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</p>
                        <p class="text-[11px] text-emerald-700 dark:text-emerald-400">
                            Ø¹Ù„Ù‰ <strong>iPhone</strong>: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© <span class="px-1 text-blue-500">â‹</span> Ø«Ù… Ø§Ø®ØªØ± "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©".<br>
                            Ø¹Ù„Ù‰ <strong>Android</strong>: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø«Ù„Ø§Ø« â‹® Ø«Ù… Ø§Ø®ØªØ± "ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" Ø£Ùˆ "Add to Home screen".
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Library View -->
        <div id="libraryView" class="hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold">Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø¯ÙˆØ§Ù„ (80 Ø¯Ø§Ù„Ø©)</h2>
                <button onclick="toggleLibrary()" class="text-red-500 font-bold">âœ–</button>
            </div>
            
            <div class="mb-4 bg-white dark:bg-gray-800 p-3 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                <select id="libSearch" onchange="searchFunction(this.value)" class="w-full p-2 bg-transparent outline-none text-sm ltr">
                    <option value="">ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯Ø§Ù„Ø©...</option>
                </select>
            </div>

            <div class="flex overflow-x-auto gap-4 mb-4 pb-2 no-scrollbar" id="libraryTabs"></div>
            <div id="libraryContent" class="space-y-4"></div>
        </div>

        <!-- Quiz View -->
        <div id="quizView" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button onclick="goHome()" class="text-gray-400">âœ–</button>
                <div id="quizCatName" class="px-4 py-1 bg-blue-50 dark:bg-blue-900/30 rounded-full text-blue-600 font-bold text-xs"></div>
                <div id="quizStepCounter" class="text-xs text-gray-400 font-bold"></div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-3xl p-6 shadow-xl border border-gray-100 dark:border-gray-700">
                <h3 id="quizQuestion" class="text-lg font-bold mb-6"></h3>
                <div class="overflow-x-auto mb-6 bg-slate-50 dark:bg-gray-900 rounded-xl p-2">
                    <table class="excel-grid w-full" id="quizTable"></table>
                </div>
                <div class="space-y-4">
                    <input type="text" id="quizInput" class="w-full p-4 bg-gray-50 dark:bg-gray-700 rounded-2xl font-mono ltr outline-none focus:ring-2 focus:ring-blue-500" placeholder="=FONCTION(...)">
                    <div id="quizFeedback" class="hidden p-4 rounded-2xl text-sm font-bold text-center"></div>
                    <button id="submitBtn" onclick="checkAnswer()" class="w-full py-4 excel-green text-white rounded-2xl font-bold shadow-lg">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
                    <button id="nextBtn" onclick="nextQuestion()" class="hidden w-full py-4 bg-blue-600 text-white rounded-2xl font-bold">Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªØ§Ù„ÙŠ â”</button>
                </div>
            </div>
        </div>

        <!-- Result -->
        <div id="resultView" class="hidden text-center py-10">
            <div class="text-6xl mb-4">ğŸ†</div>
            <h2 class="text-2xl font-bold mb-8">Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹!</h2>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-sm inline-block mb-8">
                <div class="text-4xl font-black text-excelGreen" id="finalScore">0</div>
                <div class="text-xs text-gray-400 uppercase font-bold mt-1">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</div>
            </div>
            <br>
            <button onclick="goHome()" class="px-10 py-4 bg-gray-800 text-white rounded-2xl font-bold">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
    </main>

    <script>
        const categories = {
            math: { name: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª", icon: "ğŸ“", color: "blue", functions: [
                { name: "SOMME", desc: "Ø¬Ù…Ø¹ Ù†Ø·Ø§Ù‚ Ù…Ù† Ø§Ù„Ø®Ù„Ø§ÙŠØ§.", syntax: "=SOMME(A1:A10)", example: "=SOMME(10;20)", uiData: { h:['Val'], b:[['10'],['20']], target:'B1', result:'30' }, explain: "ØªÙ‚ÙˆÙ… Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© 10 Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© 20 ÙÙŠ Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù„ØªØ¹Ø·ÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© 30." },
                { name: "PRODUIT", desc: "Ø¶Ø±Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù….", syntax: "=PRODUIT(A1;B1)", example: "=PRODUIT(5;4)", uiData: { h:['A','B'], b:[['5','4']], target:'C1', result:'20' }, explain: "ØªØ¶Ø±Ø¨ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù… 5 ÙÙŠ Ø§Ù„Ø±Ù‚Ù… 4ØŒ Ù…Ù…Ø§ ÙŠÙ†ØªØ¬ Ø¹Ù†Ù‡ Ø­Ø§ØµÙ„ Ø¶Ø±Ø¨ ÙŠØ³Ø§ÙˆÙŠ 20." },
                { name: "ARRONDI", desc: "ØªÙ‚Ø±ÙŠØ¨ Ø±Ù‚Ù….", syntax: "=ARRONDI(nb; dec)", example: "=ARRONDI(15,67; 1)", uiData: { h:['Nb'], b:[['15,67']], target:'B1', result:'15,7' }, explain: "ØªÙ‚Ø±Ø¨ Ø§Ù„Ø±Ù‚Ù… 15.67 Ø¥Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø²Ù„Ø© Ø¹Ø´Ø±ÙŠØ© ÙˆØ§Ø­Ø¯Ø©ØŒ ÙˆÙ„Ø£Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ (7) Ø£ÙƒØ¨Ø± Ù…Ù† 5ØŒ ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø±Ù‚Ù… 6 Ù„ÙŠØµØ¨Ø­ 7." },
                { name: "ABS", desc: "Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©.", syntax: "=ABS(nombre)", example: "=ABS(-50)", uiData: { h:['Val'], b:[['-50']], target:'B1', result:'50' }, explain: "ØªØ²ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ù„Ø¨Ø© Ù…Ù† Ø§Ù„Ø±Ù‚Ù… -50 Ù„ØªØ¹Ø·ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¬Ø¨Ø© Ø§Ù„ØµØ±ÙØ© ÙˆÙ‡ÙŠ 50." },
                { name: "ENT", desc: "Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØµØ­ÙŠØ­.", syntax: "=ENT(nombre)", example: "=ENT(8,9)", uiData: { h:['Val'], b:[['8,9']], target:'B1', result:'8' }, explain: "ØªØ£Ø®Ø° Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØµØ­ÙŠØ­ ÙÙ‚Ø· Ù…Ù† Ø§Ù„Ø±Ù‚Ù… 8.9 ÙˆØªØªØ¬Ø§Ù‡Ù„ Ø£ÙŠ ÙƒØ³ÙˆØ± Ø¹Ø´Ø±ÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹." },
                { name: "PUISSANCE", desc: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³.", syntax: "=PUISSANCE(nb; p)", example: "=PUISSANCE(3;2)", uiData: { h:['N','P'], b:[['3','2']], target:'C1', result:'9' }, explain: "ØªØ­Ø³Ø¨ 3 Ù…Ø±ÙÙˆØ¹Ø© Ù„Ù„Ù‚ÙˆØ© 2 (3 Ã— 3) ÙˆØªÙƒÙˆÙ† Ø§Ù„Ù†ØªÙŠØ¬Ø© 9." },
                { name: "RACINE", desc: "Ø§Ù„Ø¬Ø°Ø± Ø§Ù„ØªØ±Ø¨ÙŠØ¹ÙŠ.", syntax: "=RACINE(nb)", example: "=RACINE(16)", uiData: { h:['Val'], b:[['16']], target:'B1', result:'4' }, explain: "ØªÙˆØ¬Ø¯ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ø¶ÙØ±Ø¨ ÙÙŠ Ù†ÙØ³Ù‡ ÙŠØ¹Ø·ÙŠ 16ØŒ ÙˆÙ‡Ùˆ Ø§Ù„Ø±Ù‚Ù… 4." },
                { name: "MOD", desc: "Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚Ø³Ù…Ø©.", syntax: "=MOD(nb; div)", example: "=MOD(10;3)", uiData: { h:['N','D'], b:[['10','3']], target:'C1', result:'1' }, explain: "Ø¹Ù†Ø¯ Ù‚Ø³Ù…Ø© 10 Ø¹Ù„Ù‰ 3ØŒ ÙŠÙƒÙˆÙ† Ø§Ù„Ø­Ø§ØµÙ„ 3 ÙˆÙŠØªØ¨Ù‚Ù‰ 1ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù‡Ùˆ Ù…Ø§ ØªØ¹ÙŠØ¯Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø©." },
                { name: "PI", desc: "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø«Ø§Ø¨Øª Ø·.", syntax: "=PI()", example: "=PI()", uiData: { h:['F'], b:[['PI']], target:'A1', result:'3,14...' }, explain: "ØªØ¹ÙŠØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„Ø«Ø§Ø¨ØªØ© Ù„Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø±." },
                { name: "SOMME.SI", desc: "Ø¬Ù…Ø¹ Ù…Ø´Ø±ÙˆØ·.", syntax: "=SOMME.SI(plage; crit)", example: "=SOMME.SI(A1:A5; \">10\")", uiData: { h:['V'], b:[['5'],['15']], target:'B1', result:'15' }, explain: "ØªØ¨Ø­Ø« Ø§Ù„Ø¯Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ØŒ ÙØªØ¬Ø¯ Ø£Ù† 15 ÙÙ‚Ø· Ù‡ÙŠ Ø§Ù„Ø£ÙƒØ¨Ø± Ù…Ù† 10ØŒ ÙØªØ¬Ù…Ø¹Ù‡Ø§ ÙˆØ­Ø¯Ù‡Ø§." }
            ], quiz: { q: "Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ B Ù…Ù† Ø§Ù„Ø³Ø·Ø± 1 Ù„Ù€ 3.", table: { h:['A','B'], b:[['P1','100'],['P2','200'],['P3','300']] }, correct: ["=SOMME(B1:B3)"], points: 10 } },
            
            logic: { name: "Ø§Ù„Ù…Ù†Ø·Ù‚", icon: "ğŸ§ ", color: "purple", functions: [
                { name: "SI", desc: "Ø¯Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ø·.", syntax: "=SI(test; v; f)", example: "=SI(A1>10; \"OK\"; \"NO\")", uiData: { h:['Note'], b:[['12']], target:'B1', result:'OK' }, explain: "ØªØªØ­Ù‚Ù‚ Ù‡Ù„ 12 Ø£ÙƒØ¨Ø± Ù…Ù† 10ØŸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù†Ø¹Ù…ØŒ Ù„Ø°Ø§ ØªØ®ØªØ§Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ 'OK'." },
                { name: "ET", desc: "Ø´Ø±Ø· (Ùˆ).", syntax: "=ET(c1; c2)", example: "=ET(5>2; 1<3)", uiData: { h:['T1','T2'], b:[['Vrai','Vrai']], target:'C1', result:'VRAI' }, explain: "Ø¨Ù…Ø§ Ø£Ù† ÙƒÙ„Ø§ Ø§Ù„Ø´Ø±Ø·ÙŠÙ† ØµØ­ÙŠØ­ÙŠÙ† (5 Ø£ÙƒØ¨Ø± Ù…Ù† 2 Ùˆ 1 Ø£ØµØºØ± Ù…Ù† 3)ØŒ ØªØ¹Ø·ÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ù†ØªÙŠØ¬Ø© 'VRAI'." },
                { name: "OU", desc: "Ø´Ø±Ø· (Ø£Ùˆ).", syntax: "=OU(c1; c2)", example: "=OU(5>10; 1<3)", uiData: { h:['T1','T2'], b:[['Faux','Vrai']], target:'C1', result:'VRAI' }, explain: "Ø±ØºÙ… Ø£Ù† Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø£ÙˆÙ„ Ø®Ø·Ø£ØŒ Ø¥Ù„Ø§ Ø£Ù† ÙˆØ¬ÙˆØ¯ Ø´Ø±Ø· ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­ ÙŠÙƒÙÙŠ Ù„ØªÙƒÙˆÙ† Ø§Ù„Ù†ØªÙŠØ¬Ø© 'VRAI'." },
                { name: "SI.ERREUR", desc: "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡.", syntax: "=SI.ERREUR(v; val_err)", example: "=SI.ERREUR(A1/B1; 0)", uiData: { h:['A','B'], b:[['10','0']], target:'C1', result:'0' }, explain: "Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¸Ù‡Ø§Ø± Ø®Ø·Ø£ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ ØµÙØ± (#DIV/0!)ØŒ ØªÙ‚ÙˆÙ… Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© 0." }
            ], quiz: { q: "Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙŠØ© A1 Ø£ÙƒØ¨Ø± Ù…Ù† 10 Ø§ÙƒØªØ¨ 'Pass' ÙˆØ¥Ù„Ø§ 'Fail'.", table: { h:['A'], b:[['15']] }, correct: ["=SI(A1>10;\"PASS\";\"FAIL\")"], points: 15 } },
            
            text: { name: "Ø§Ù„Ù†ØµÙˆØµ", icon: "ğŸ“", color: "yellow", functions: [
                { name: "CONCAT", desc: "Ø¯Ù…Ø¬ Ù†ØµÙˆØµ.", syntax: "=CONCAT(A1; B1)", example: "=CONCAT(\"Hi \"; \"Ali\")", uiData: { h:['T1','T2'], b:[['Hi','Ali']], target:'C1', result:'Hi Ali' }, explain: "ØªØ±Ø¨Ø· Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù„ØªÙƒÙˆÙŠÙ† Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ù…ØªØµÙ„Ø©." },
                { name: "GAUCHE", desc: "Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±.", syntax: "=GAUCHE(t; n)", example: "=GAUCHE(\"Excel\"; 2)", uiData: { h:['T'], b:[['Excel']], target:'B1', result:'Ex' }, explain: "ØªØ³ØªØ®Ø±Ø¬ Ø£ÙˆÙ„ Ø­Ø±ÙÙŠÙ† Ù…Ù† Ø¬Ù‡Ø© Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„ÙƒÙ„Ù…Ø© 'Excel'." },
                { name: "NBCAR", desc: "Ø·ÙˆÙ„ Ø§Ù„Ù†Øµ.", syntax: "=NBCAR(t)", example: "=NBCAR(\"ABC\")", uiData: { h:['T'], b:[['ABC']], target:'B1', result:'3' }, explain: "ØªÙ‚ÙˆÙ… Ø¨Ø¹Ø¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙˆÙ ÙÙŠ Ø§Ù„Ù†Øµ 'ABC' ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© Ù‡ÙŠ 3 Ø­Ø±ÙˆÙ." },
                { name: "MAJUSCULE", desc: "ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø­Ø±ÙˆÙ.", syntax: "=MAJUSCULE(t)", example: "=MAJUSCULE(\"ali\")", uiData: { h:['T'], b:[['ali']], target:'B1', result:'ALI' }, explain: "ØªØ­ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø­Ø±ÙˆÙ Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØºÙŠØ±Ø© (Lowercase) Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (Uppercase)." }
            ], quiz: { q: "Ø§Ø¯Ù…Ø¬ Ø§Ù„Ø§Ø³Ù… ÙÙŠ A1 ÙˆØ§Ù„Ù„Ù‚Ø¨ ÙÙŠ B1 Ù…Ø¹ Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ†Ù‡Ù…Ø§.", table: { h:['A','B'], b:[['Ali','Ahmed']] }, correct: ["=CONCAT(A1;\" \";B1)","=A1&\" \"&B1"], points: 10 } },
            
            lookup: { name: "Ø§Ù„Ø¨Ø­Ø«", icon: "ğŸ”", color: "red", functions: [
                { name: "RECHERCHEV", desc: "Ø¨Ø­Ø« Ø¹Ù…ÙˆØ¯ÙŠ.", syntax: "=RECHERCHEV(v; tab; col; 0)", example: "=RECHERCHEV(\"1\"; A1:B2; 2; 0)", uiData: { h:['ID','Nom'], b:[['1','Ali'],['2','Bob']], target:'D1', result:'Ali' }, explain: "ØªØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø±Ù '1' ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ØŒ ÙˆØ¹Ù†Ø¯Ù…Ø§ ØªØ¬Ø¯Ù‡ ØªØ£Ø®Ø° Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ù„Ù‡ Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù†ÙŠ." },
                { name: "RECHERCHEX", desc: "Ø¨Ø­Ø« Ù…ØªØ·ÙˆØ±.", syntax: "=RECHERCHEX(v; v_p; r_p)", example: "=RECHERCHEX(\"A\"; A1:A2; B1:B2)", uiData: { h:['K','V'], b:[['A','100']], target:'C1', result:'100' }, explain: "ØªØ¨Ø­Ø« Ø¹Ù† 'A' ÙÙŠ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¨Ø­Ø«ØŒ ÙˆØªØ¹ÙŠØ¯ Ù…Ø§ ÙŠÙ‚Ø§Ø¨Ù„Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ù†Ø·Ø§Ù‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø¯Ø¯." }
            ], quiz: { q: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³Ø¹Ø± 'PC' ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ A1:B3 (Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ 2).", table: { h:['Prod','Prix'], b:[['PC','500'],['TV','300']] }, correct: ["=RECHERCHEV(\"PC\";A1:B3;2;0)"], points: 20 } },
            
            stat: { name: "Ø§Ù„Ø¥Ø­ØµØ§Ø¡", icon: "ğŸ“Š", color: "green", functions: [
                { name: "MOYENNE", desc: "Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ.", syntax: "=MOYENNE(p)", example: "=MOYENNE(10;20)", uiData: { h:['V'], b:[['10'],['20']], target:'B1', result:'15' }, explain: "ØªØ¬Ù…Ø¹ 10 Ù…Ø¹ 20 (Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ 30) Ø«Ù… ØªÙ‚Ø³Ù… Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯Ù‡Ù…Ø§ (2) Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ù…ØªÙˆØ³Ø· 15." },
                { name: "MAX", desc: "Ø£ÙƒØ¨Ø± Ù‚ÙŠÙ…Ø©.", syntax: "=MAX(p)", example: "=MAX(1;5;2)", uiData: { h:['V'], b:[['1'],['5'],['2']], target:'B1', result:'5' }, explain: "ØªÙ‚Ø§Ø±Ù† Ø¨ÙŠÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø«Ù„Ø§Ø«Ø© ÙˆØªØ®ØªØ§Ø± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ¨Ø± Ø¨ÙŠÙ†Ù‡Ø§ ÙˆÙ‡Ùˆ 5." },
                { name: "NB.SI", desc: "Ø¹Ø¯ Ù…Ø´Ø±ÙˆØ·.", syntax: "=NB.SI(p; crit)", example: "=NB.SI(A1:A2; \">10\")", uiData: { h:['V'], b:[['5'],['15']], target:'B1', result:'1' }, explain: "ØªØ¹Ø¯ ÙƒÙ… Ø®Ù„ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø£ÙƒØ¨Ø± Ù…Ù† 10ØŒ ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© Ù‡ÙŠ Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· (Ø§Ù„ØªÙŠ Ø¨Ù‡Ø§ 15)." }
            ], quiz: { q: "Ø£ÙˆØ¬Ø¯ Ø£ÙƒØ¨Ø± Ù‚ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ A1:A4.", table: { h:['V'], b:[['10'],['50'],['20'],['40']] }, correct: ["=MAX(A1:A4)"], points: 10 } },
            
            date: { name: "Ø§Ù„ØªØ§Ø±ÙŠØ®", icon: "ğŸ“…", color: "indigo", functions: [
                { name: "ANNEE", desc: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ù†Ø©.", syntax: "=ANNEE(d)", example: "=ANNEE(\"15/05/2023\")", uiData: { h:['D'], b:[['15/05/23']], target:'B1', result:'2023' }, explain: "ØªØ­Ù„Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø·Ù‰ ÙˆØªØ³ØªØ®Ù„Øµ Ù…Ù†Ù‡ Ø±Ù‚Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø±Ù‚Ø§Ù… ÙˆÙ‡Ùˆ 2023." },
                { name: "JOUR", desc: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙŠÙˆÙ….", syntax: "=JOUR(d)", example: "=JOUR(\"05/12/2023\")", uiData: { h:['D'], b:[['05/12/23']], target:'B1', result:'5' }, explain: "ØªØ³ØªØ®Ø±Ø¬ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ ÙˆÙ‡Ùˆ Ù‡Ù†Ø§ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø®Ø§Ù…Ø³ Ù…Ù† Ø§Ù„Ø´Ù‡Ø±." }
            ], quiz: { q: "Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø³Ù†Ø© Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ A1.", table: { h:['A'], b:[['20/12/2025']] }, correct: ["=ANNEE(A1)"], points: 10 } }
        };

        let totalPoints = parseInt(localStorage.getItem('excelPoints') || 0);
        let currentQuizQueue = [];
        let currentStep = 0;
        let sessionScore = 0;
        let activeLibraryCat = 'math';

        function init() {
            document.getElementById('userPoints').innerText = totalPoints;
            const grid = document.getElementById('categoriesGrid');
            Object.keys(categories).forEach(key => {
                const cat = categories[key];
                const div = document.createElement('div');
                div.className = `bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-sm border-b-4 border-${cat.color}-500 flex flex-col items-center cursor-pointer active:scale-95 transition-all`;
                div.onclick = () => startSingleQuiz(key);
                div.innerHTML = `<span class="text-3xl mb-1">${cat.icon}</span><span class="font-bold text-xs">${cat.name}</span>`;
                grid.appendChild(div);
            });
            buildLibraryTabs();
            populateSearchList();

            // Scroll listener for Top Button
            window.addEventListener('scroll', () => {
                const btn = document.getElementById('scrollTopBtn');
                const isLibraryVisible = !document.getElementById('libraryView').classList.contains('hidden');
                if (isLibraryVisible && window.scrollY > 300) {
                    btn.classList.add('visible');
                } else {
                    btn.classList.remove('visible');
                }
            });
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function populateSearchList() {
            const select = document.getElementById('libSearch');
            let all = [];
            Object.keys(categories).forEach(k => categories[k].functions.forEach(f => all.push({n: f.name, k})));
            all.sort((a,b) => a.n.localeCompare(b.n));
            all.forEach(item => {
                const opt = document.createElement('option');
                opt.value = `${item.k}|${item.n}`;
                opt.innerText = item.n;
                select.appendChild(opt);
            });
        }

        function searchFunction(val) {
            if(!val) return;
            const [cat, name] = val.split('|');
            activeLibraryCat = cat;
            buildLibraryTabs();
            renderLibraryContent(cat);
            setTimeout(() => {
                const el = document.getElementById(`func-${name}`);
                if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
            }, 100);
        }

        function buildLibraryTabs() {
            const container = document.getElementById('libraryTabs');
            container.innerHTML = '';
            Object.keys(categories).forEach(key => {
                const cat = categories[key];
                const btn = document.createElement('button');
                btn.className = `category-tab px-3 py-1 whitespace-nowrap text-xs transition-all ${activeLibraryCat === key ? 'active' : 'text-gray-400'}`;
                btn.onclick = () => { activeLibraryCat = key; buildLibraryTabs(); renderLibraryContent(key); };
                btn.innerText = `${cat.icon} ${cat.name}`;
                container.appendChild(btn);
            });
        }

        function renderLibraryContent(catKey) {
            const container = document.getElementById('libraryContent');
            container.innerHTML = '';
            categories[catKey].functions.forEach(func => {
                const card = document.createElement('div');
                card.id = `func-${func.name}`;
                card.className = "bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm border-r-4 border-" + categories[catKey].color + "-500";
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-excelGreen">${func.name}</h4>
                        <span class="text-[9px] bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded">FRANCE</span>
                    </div>
                    <p class="text-sm font-medium mb-3">${func.desc}</p>
                    <div class="excel-ui-box mb-3 ltr">
                        <div class="excel-formula-bar bg-gray-50 dark:bg-gray-700">fx | ${func.example}</div>
                        <div class="p-2 overflow-x-auto">
                            <table class="excel-grid w-full">
                                <thead><tr><th></th>${func.uiData.h.map(h => `<th>${h}</th>`).join('')}</tr></thead>
                                <tbody>${func.uiData.b.map((r, i) => `<tr><th>${i+1}</th>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('')}</tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-xl border border-green-100 flex justify-between items-center mb-3">
                         <div class="flex items-center gap-2 ltr">
                            <div class="w-6 h-6 bg-green-500 text-white rounded flex items-center justify-center text-[10px] font-bold">${func.uiData.target}</div>
                            <span class="text-sm font-bold text-green-700 dark:text-green-300">${func.uiData.result}</span>
                         </div>
                         <span class="text-[10px] font-bold text-gray-400">Ø§Ù„Ù†ØªÙŠØ¬Ø©</span>
                    </div>
                    <div class="bg-blue-50 dark:bg-blue-900/10 p-3 rounded-xl border border-blue-100 dark:border-blue-900/30">
                        <p class="text-[10px] font-bold text-blue-600 mb-1">ğŸ’¡ Ø´Ø±Ø­ Ø§Ù„Ù…Ø«Ø§Ù„:</p>
                        <p class="text-xs text-gray-600 dark:text-gray-300 leading-relaxed">${func.explain || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹."}</p>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleLibrary() {
            const dash = document.getElementById('dashboard');
            const lib = document.getElementById('libraryView');
            const float = document.getElementById('floatingHome');
            const scrollBtn = document.getElementById('scrollTopBtn');
            if (lib.classList.contains('hidden')) {
                dash.classList.add('hidden');
                lib.classList.remove('hidden');
                float.classList.add('visible');
                renderLibraryContent(activeLibraryCat);
            } else {
                lib.classList.add('hidden');
                dash.classList.remove('hidden');
                float.classList.remove('visible');
                scrollBtn.classList.remove('visible');
            }
        }

        function startFullQuiz() {
            currentQuizQueue = Object.keys(categories);
            currentStep = 0; sessionScore = 0; showQuiz();
        }

        function startSingleQuiz(key) {
            currentQuizQueue = [key];
            currentStep = 0; sessionScore = 0; showQuiz();
        }

        function showQuiz() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('quizView').classList.remove('hidden');
            document.getElementById('floatingHome').classList.add('visible');
            loadQuestion();
        }

        function loadQuestion() {
            const catKey = currentQuizQueue[currentStep];
            const data = categories[catKey];
            document.getElementById('quizCatName').innerText = data.name;
            document.getElementById('quizStepCounter').innerText = `${currentStep+1} / ${currentQuizQueue.length}`;
            document.getElementById('quizQuestion').innerText = data.quiz.q;
            document.getElementById('quizInput').value = "";
            document.getElementById('quizFeedback').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('submitBtn').classList.remove('hidden');
            const table = document.getElementById('quizTable');
            table.innerHTML = `<thead><tr><th></th>${data.quiz.table.h.map(h => `<th>${h}</th>`).join('')}</tr></thead>
                               <tbody>${data.quiz.table.b.map((r, i) => `<tr><th>${i+1}</th>${r.map(c => `<td>${c}</td>`).join('')}</tr>`).join('')}</tbody>`;
        }

        function checkAnswer() {
            const input = document.getElementById('quizInput').value.trim().toUpperCase().replace(/\s/g, '');
            const quiz = categories[currentQuizQueue[currentStep]].quiz;
            const isCorrect = quiz.correct.some(a => a.toUpperCase().replace(/\s/g, '') === input);
            const feedback = document.getElementById('quizFeedback');
            feedback.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
            if(isCorrect) {
                feedback.innerText = "Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…";
                feedback.classList.add('bg-green-100', 'text-green-700');
                sessionScore += quiz.points;
                totalPoints += quiz.points;
                localStorage.setItem('excelPoints', totalPoints);
                document.getElementById('userPoints').innerText = totalPoints;
                document.getElementById('submitBtn').classList.add('hidden');
                document.getElementById('nextBtn').classList.remove('hidden');
            } else {
                feedback.innerText = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ âŒ";
                feedback.classList.add('bg-red-100', 'text-red-700');
            }
        }

        function nextQuestion() {
            if(currentStep < currentQuizQueue.length - 1) {
                currentStep++; loadQuestion();
            } else {
                document.getElementById('quizView').classList.add('hidden');
                document.getElementById('resultView').classList.remove('hidden');
                document.getElementById('finalScore').innerText = sessionScore;
            }
        }

        function goHome() {
            document.getElementById('libraryView').classList.add('hidden');
            document.getElementById('quizView').classList.add('hidden');
            document.getElementById('resultView').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('floatingHome').classList.remove('visible');
            document.getElementById('scrollTopBtn').classList.remove('visible');
            window.scrollTo(0,0);
        }

        window.onload = init;
    </script>
</body>
</html>